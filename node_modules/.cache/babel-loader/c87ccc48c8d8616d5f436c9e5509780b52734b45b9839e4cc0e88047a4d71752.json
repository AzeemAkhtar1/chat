{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport { ref, onMounted, computed, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport UserList from '../components/chat/UserList.vue';\nimport ChatWindow from '../components/chat/ChatWindow.vue';\nimport MessageInput from '../components/chat/MessageInput.vue';\nimport { initializeSocket } from '../services/socket';\nimport axios from 'axios';\nexport default {\n  name: 'ChatView',\n  components: {\n    UserList,\n    ChatWindow,\n    MessageInput\n  },\n  setup() {\n    const store = useStore();\n    const socket = ref(null);\n    const onlineUsers = ref([]);\n    const selectedUser = ref(null);\n    const messages = ref([]);\n    const isTyping = ref(false);\n    const currentUser = computed(() => store.getters['auth/currentUser']);\n\n    // Fetch messages for selected user\n    const fetchMessages = async userId => {\n      try {\n        const response = await axios.get(`/api/messages/${userId}`, {\n          headers: {\n            Authorization: `Bearer ${currentUser.value.token}`\n          }\n        });\n        messages.value = response.data;\n      } catch (error) {\n        console.error('Error fetching messages:', error);\n      }\n    };\n\n    // Watch for selected user changes\n    watch(selectedUser, newUser => {\n      if (newUser) {\n        fetchMessages(newUser._id);\n      }\n    });\n    onMounted(async () => {\n      socket.value = await initializeSocket(currentUser.value.token);\n      socket.value.on('users', users => {\n        onlineUsers.value = users.filter(user => user._id !== currentUser.value._id);\n      });\n      socket.value.on('message', message => {\n        // Add timestamp using local time\n        message.timestamp = new Date().toISOString();\n        messages.value.push(message);\n      });\n      socket.value.on('typing', user => {\n        if (selectedUser.value && user._id === selectedUser.value._id) {\n          isTyping.value = true;\n          setTimeout(() => {\n            isTyping.value = false;\n          }, 3000);\n        }\n      });\n\n      // Handle reconnection\n      socket.value.on('connect', () => {\n        if (selectedUser.value) {\n          fetchMessages(selectedUser.value._id);\n        }\n      });\n    });\n    const selectUser = user => {\n      selectedUser.value = user;\n    };\n    const sendMessage = content => {\n      if (!selectedUser.value) return;\n      const message = {\n        from: currentUser.value._id,\n        to: selectedUser.value._id,\n        content,\n        timestamp: new Date().toISOString()\n      };\n      socket.value.emit('send-message', message);\n      messages.value.push(message);\n    };\n    return {\n      onlineUsers,\n      selectedUser,\n      messages,\n      currentUser,\n      isTyping,\n      selectUser,\n      sendMessage\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","watch","useStore","UserList","ChatWindow","MessageInput","initializeSocket","axios","name","components","setup","store","socket","onlineUsers","selectedUser","messages","isTyping","currentUser","getters","fetchMessages","userId","response","get","headers","Authorization","value","token","data","error","console","newUser","_id","on","users","filter","user","message","timestamp","Date","toISOString","push","setTimeout","selectUser","sendMessage","content","from","to","emit"],"sources":["E:\\cursor\\client\\src\\views\\Chat.vue"],"sourcesContent":["<template>\r\n    <div class=\"container-fluid mt-4\">\r\n      <div class=\"row\">\r\n        <!-- Users List Sidebar -->\r\n        <div class=\"col-md-3\">\r\n          <div class=\"card\">\r\n            <div class=\"card-header\">\r\n              <h5 class=\"mb-0\">Online Users</h5>\r\n            </div>\r\n            <div class=\"card-body p-0\">\r\n              <user-list \r\n                :users=\"onlineUsers\"\r\n                :selectedUser=\"selectedUser\"\r\n                @select-user=\"selectUser\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n  \r\n        <!-- Chat Window -->\r\n        <div class=\"col-md-9\">\r\n          <div class=\"card\">\r\n            <div class=\"card-header bg-primary text-white\">\r\n              <h5 class=\"mb-0\">\r\n                {{ selectedUser ? `Chat with ${selectedUser.username}` : 'Select a user to start chatting' }}\r\n              </h5>\r\n            </div>\r\n            <div class=\"card-body chat-body\">\r\n              <chat-window \r\n                v-if=\"selectedUser\"\r\n                :messages=\"messages\"\r\n                :currentUser=\"currentUser\"\r\n                :selectedUser=\"selectedUser\"\r\n              />\r\n              <message-input \r\n                v-if=\"selectedUser\"\r\n                @send-message=\"sendMessage\"\r\n                :isTyping=\"isTyping\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { ref, onMounted, computed, watch } from 'vue'\r\n  import { useStore } from 'vuex'\r\n  import UserList from '../components/chat/UserList.vue'\r\n  import ChatWindow from '../components/chat/ChatWindow.vue'\r\n  import MessageInput from '../components/chat/MessageInput.vue'\r\n  import { initializeSocket } from '../services/socket'\r\n  import axios from 'axios'\r\n  \r\n  export default {\r\n    name: 'ChatView',\r\n    components: {\r\n      UserList,\r\n      ChatWindow,\r\n      MessageInput\r\n    },\r\n    setup() {\r\n      const store = useStore()\r\n      const socket = ref(null)\r\n      const onlineUsers = ref([])\r\n      const selectedUser = ref(null)\r\n      const messages = ref([])\r\n      const isTyping = ref(false)\r\n      \r\n      const currentUser = computed(() => store.getters['auth/currentUser'])\r\n  \r\n      // Fetch messages for selected user\r\n      const fetchMessages = async (userId) => {\r\n        try {\r\n          const response = await axios.get(`/api/messages/${userId}`, {\r\n            headers: {\r\n              Authorization: `Bearer ${currentUser.value.token}`\r\n            }\r\n          })\r\n          messages.value = response.data\r\n        } catch (error) {\r\n          console.error('Error fetching messages:', error)\r\n        }\r\n      }\r\n  \r\n      // Watch for selected user changes\r\n      watch(selectedUser, (newUser) => {\r\n        if (newUser) {\r\n          fetchMessages(newUser._id)\r\n        }\r\n      })\r\n  \r\n      onMounted(async () => {\r\n        socket.value = await initializeSocket(currentUser.value.token)\r\n        \r\n        socket.value.on('users', (users) => {\r\n          onlineUsers.value = users.filter(user => user._id !== currentUser.value._id)\r\n        })\r\n  \r\n        socket.value.on('message', (message) => {\r\n          // Add timestamp using local time\r\n          message.timestamp = new Date().toISOString()\r\n          messages.value.push(message)\r\n        })\r\n  \r\n        socket.value.on('typing', (user) => {\r\n          if (selectedUser.value && user._id === selectedUser.value._id) {\r\n            isTyping.value = true\r\n            setTimeout(() => { isTyping.value = false }, 3000)\r\n          }\r\n        })\r\n  \r\n        // Handle reconnection\r\n        socket.value.on('connect', () => {\r\n          if (selectedUser.value) {\r\n            fetchMessages(selectedUser.value._id)\r\n          }\r\n        })\r\n      })\r\n  \r\n      const selectUser = (user) => {\r\n        selectedUser.value = user\r\n      }\r\n  \r\n      const sendMessage = (content) => {\r\n        if (!selectedUser.value) return\r\n  \r\n        const message = {\r\n          from: currentUser.value._id,\r\n          to: selectedUser.value._id,\r\n          content,\r\n          timestamp: new Date().toISOString()\r\n        }\r\n  \r\n        socket.value.emit('send-message', message)\r\n        messages.value.push(message)\r\n      }\r\n  \r\n      return {\r\n        onlineUsers,\r\n        selectedUser,\r\n        messages,\r\n        currentUser,\r\n        isTyping,\r\n        selectUser,\r\n        sendMessage\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .chat-body {\r\n    padding: 0;\r\n    height: calc(100vh - 200px);\r\n    overflow: hidden;\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}